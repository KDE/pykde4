<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
  <title>KSaveFile</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>
<body>
<span style="font-size : 10pt;">
<table width="100%">
  <tr>
    <td width ="70%">
      <h1>class KSaveFile</h1><hr>
      <h3><i style="color : #00aa00"></i></h3>
    </td>
  </tr>
</table>
<table cellpadding="10">
  <tr>
    <td valign="top" width="35%">
      <table bgcolor="#f7f7ff" cellpadding="4">
        <tr>
          <td width="10%" align=left>Module</td>
          <td width="30%" align=left>kdecore</td>
        </tr>
        <tr>
          <td width="10%" align=left>Namespace</td>
          <td width="30%" align=left></td>
        </tr>
        <tr>
          <td>Class</td>
          <td>KSaveFile</td>
        </tr>
        <tr>
          <td>Inherits</td>
          <td>QFile</td>
        </tr>
      </table>
    </td>
    <td width="65%">
      \class KSaveFile ksavefile.h <KSaveFile>
</p>
<p>
Class to allow for atomic file I/O, as well as utility functions.
</p>
<p>
The KSaveFile class has been made to write out changes to an existing
file atomically. This means that either <b>ALL</b> changes will be written
to the file, or <b>NO</b> changes have been written, and the original file
(if any) has been unchanged. This is useful if you have lots of
time-consuming processing to perform during which an interruption could
occur, or if any error in the file structure will cause the entire file
to be corrupt.
</p>
<p>
When you create a KSaveFile for a given file, a temporary file is instead
created and all your I/O occurs in the save file. Once you call finalize()
the temporary file is renamed to the target file, so that all your changes
happen at once. If abort() is called then the temporary file is removed and
the target file is untouched. KSaveFile derives from QFile so you can use
it just as you would a normal QFile.
</p>
<p>
This class also includes several static utility functions available that
can help ensure data integrity. See the individual functions for details.
</p>
<p>
Here is a quick example of how to use KSaveFile:
</p>
<p>
First we create the KSaveFile and open it.
</p>
<p>
<pre>
KSaveFile saveFile;
saveFile.setFileName("/lib/foo/bar.dat");
if ( !saveFile.open() ) {
//Handle error
}
</pre>
</p>
<p>
At this point the file "/lib/foo/bar.dat" has not been altered in any way.
Now, let's write out some data to the file.
</p>
<p>
<pre>
QTextStream stream ( &saveFile );
stream << "Add some data.";
// Perform long processing
stream << "Add some more data.";
stream.flush();
</pre>
</p>
<p>
Even after writing this data, the target file "/lib/foo/bar.dat" still has
not been altered in any way. Now that we are done writing our data, we can
write out all the changes that we have made by calling finalize().
</p>
<p>
<pre>
if ( !saveFile.finalize() ) {
//Handle error
}
</pre>
</p>
<p>
If a user interruption or error occurred while we were writing out our
changes, we would instead call abort() to cancel all the I/O without
affecting the target file.
</p>
<p>
See also  QFile
</p>
<p>
<b>Author</b> Jaison Lee <lee.jaison@gmail.com>
<b>Author</b> Waldo Bastian <bastian@kde.org>
    </td>
  </tr>
</table>
<hr>
<hr>
<h3>methods</h3><ul style="list-style-type : none">
<li><b style="color : #000000;">KSaveFile</b> ( )
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table>
        <tr>
          <td>
            returns <i>ctor</i>
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr><td></td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Default constructor.
    </td>
  </tr>
</table>

</li><hr>

<li style="list-style-type : none"><b style="color : #000000;">KSaveFile</b> (filename, componentData)
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table vspace="5">
        <tr>
          <td>
            returns <i>ctor</i>
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        </tr>
        <tr>
          <td>
          KDE 4.1.0 and later only
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr  bgcolor="#e7e7ff">
                <th>Argument</th><th>Type</th><th>Default</th>
              </tr>
              <tr><td>filename</td><td>QString</td><td align="right"></td></tr>
              <tr><td>componentData</td><td>KComponentData</td><td align="right">KGlobal.mainComponent()</td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Creates a new KSaveFile and sets the target file to <b>filename.</b>
</p>
<p></p>
<p>
<b>filename</b> - the path of the file</p>
<p>
<b>componentData</b> - The KComponentData to use for the temporary file.
    </td>
  </tr>
</table>

</li><hr>

<li style="list-style-type : none"><b style="color : #999999;">KSaveFile</b> (a0)
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table vspace="5">
        <tr>
          <td>
            returns <i>ctor</i>
          </td>
        </tr>
        <tr>
          <td>
          <i style="color : #aa0000">Not implemented</i>
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr  bgcolor="#e7e7ff">
                <th>Argument</th><th>Type</th><th>Default</th>
              </tr>
              <tr><td>a0</td><td>KSaveFile</td><td align="right"></td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">

    </td>
  </tr>
</table>

</li><hr>

<li style="list-style-type : none"><b style="color : #000000;">KSaveFile</b> (a0, a1)
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table vspace="5">
        <tr>
          <td>
            returns <i>ctor</i>
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        </tr>
        <tr>
          <td>
          before KDE 4.1.0 only
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr  bgcolor="#e7e7ff">
                <th>Argument</th><th>Type</th><th>Default</th>
              </tr>
              <tr><td>a0</td><td>QString</td><td align="right"></td></tr>
              <tr><td>a1</td><td>KComponentData</td><td align="right">KGlobal.mainComponent()</td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">

    </td>
  </tr>
</table>

</li><hr>

<li><b style="color : #000000;">abort</b> ( )
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table>
        <tr>
          <td>
            returns <i>Nothing</i>
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr><td></td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Discard changes without affecting the target file.
This will discard all changes that have been made to this file.
The target file will not be altered in any way.
    </td>
  </tr>
</table>

</li><hr>

<li style="list-style-type : none"><b style="color : #000000;">backupFile</b> (filename, backupDir)
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table vspace="5">
        <tr>
          <td>
            returns <i>bool</i>
          </td>
        </tr>
        <tr>
          <td>
          <b style="color : #0000aa">static</b> 
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr  bgcolor="#e7e7ff">
                <th>Argument</th><th>Type</th><th>Default</th>
              </tr>
              <tr><td>filename</td><td>QString</td><td align="right"></td></tr>
              <tr><td>backupDir</td><td>QString</td><td align="right">QString()</td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Static method to create a backup file before saving.
</p>
<p>
If empty (the default), the backup will be in the same directory as <b>filename.</b>
The backup type (simple, rcs, or numbered), extension string, and maximum
number of backup files are read from the user's global configuration.
Use simpleBackupFile() or numberedBackupFile() to force one of these
specific backup styles.
You can use this method even if you don't use KSaveFile.</p>
<p>
<b>filename</b> - the file to backup</p>
<p>
<b>backupDir</b> - optional directory where to save the backup file in.
Returns true if successful, or false if an error has occurred.
    </td>
  </tr>
</table>

</li><hr>

<li><b style="color : #000000;">error</b> ( )
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table>
        <tr>
          <td>
            returns <i>QFile.FileError</i>
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr><td></td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Returns the last error that occurred.
Use this function to check for errors.
Returns The last error that occurred, or QFile.NoError.
    </td>
  </tr>
</table>

</li><hr>

<li><b style="color : #000000;">errorString</b> ( )
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table>
        <tr>
          <td>
            returns <i>QString</i>
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr><td></td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Returns a human-readable description of the last error.
Use this function to get a human-readable description of the
last error that occurred.
Returns A string describing the last error that occurred.
    </td>
  </tr>
</table>

</li><hr>

<li><b style="color : #000000;">fileName</b> ( )
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table>
        <tr>
          <td>
            returns <i>QString</i>
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr><td></td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Returns the name of the target file.
This function returns the name of the target file, or an empty
QString if it has not yet been set.
Returns The name of the target file.
    </td>
  </tr>
</table>

</li><hr>

<li><b style="color : #000000;">finalize</b> ( )
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table>
        <tr>
          <td>
            returns <i>bool</i>
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr><td></td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Finalize changes to the file.
This will commit all the changes that have been made to the file.
Returns true if successful, or false if an error has occurred.
    </td>
  </tr>
</table>

</li><hr>

<li style="list-style-type : none"><b style="color : #000000;">numberedBackupFile</b> (filename, backupDir, backupExtension, maxBackups)
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table vspace="5">
        <tr>
          <td>
            returns <i>bool</i>
          </td>
        </tr>
        <tr>
          <td>
          <b style="color : #0000aa">static</b> 
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr  bgcolor="#e7e7ff">
                <th>Argument</th><th>Type</th><th>Default</th>
              </tr>
              <tr><td>filename</td><td>QString</td><td align="right"></td></tr>
              <tr><td>backupDir</td><td>QString</td><td align="right">QString()</td></tr>
              <tr><td>backupExtension</td><td>QString</td><td align="right">QString.fromLatin1("~")</td></tr>
              <tr><td>maxBackups</td><td>uint</td><td align="right">10</td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Static method to create a backup file for a given filename.
</p>
<p>
This function creates a series of numbered backup files from the
given filename.
</p>
<p>
The backup file names will be of the form:
\<name\>.\<number\>\<extension\>
for instance
<pre> chat.3.log </pre>
</p>
<p>
The new backup file will be have the backup number 1.
Each existing backup file will have its number incremented by 1.
Any backup files with numbers greater than the maximum number
permitted (@p maxBackups) will be removed.
You can use this method even if you don't use KSaveFile.
</p>
<p></p>
<p>
<b>filename</b> - the file to backup</p>
<p>
<b>backupDir</b> - optional directory where to save the backup file in.
If empty (the default), the backup will be in the same directory as
<b>filename.</b></p>
<p>
<b>backupExtension</b> - the extension to append to <b>filename,</b>
which is "~" by default. Do not use an extension containing digits.</p>
<p>
<b>maxBackups</b> - the maximum number of backup files permitted.
For best performance a small number (10) is recommended.
Returns true if successful, or false if an error has occurred.
    </td>
  </tr>
</table>

</li><hr>

<li style="list-style-type : none"><b style="color : #000000;">open</b> (flags)
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table vspace="5">
        <tr>
          <td>
            returns <i>bool</i>
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr  bgcolor="#e7e7ff">
                <th>Argument</th><th>Type</th><th>Default</th>
              </tr>
              <tr><td>flags</td><td>QIODevice.OpenMode</td><td align="right">QIODevice.ReadWrite</td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Open the save file.
This function will open the save file by creating a temporary file to write
to. It will also check to ensure that there are sufficient permissions to
write to the target file.
</p>
<p></p>
<p>
<b>flags</b> - Sets the QIODevice.OpenMode. It should contain the write flag, otherwise you
have a save file you cannot save to.
</p>
<p>
Returns true if successful, or false if an error has occurred.
    </td>
  </tr>
</table>

</li><hr>

<li style="list-style-type : none"><b style="color : #000000;">rcsBackupFile</b> (filename, backupDir, backupMessage)
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table vspace="5">
        <tr>
          <td>
            returns <i>bool</i>
          </td>
        </tr>
        <tr>
          <td>
          <b style="color : #0000aa">static</b> 
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr  bgcolor="#e7e7ff">
                <th>Argument</th><th>Type</th><th>Default</th>
              </tr>
              <tr><td>filename</td><td>QString</td><td align="right"></td></tr>
              <tr><td>backupDir</td><td>QString</td><td align="right">QString()</td></tr>
              <tr><td>backupMessage</td><td>QString</td><td align="right">QString()</td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Static method to create an rcs backup file for a given filename.
</p>
<p>
This function creates a rcs-formatted backup file from the
given filename.
</p>
<p>
The backup file names will be of the form:
\<name\>,v
for instance
<pre> photo.jpg,v </pre>
</p>
<p>
The new backup file will be in RCS format.
Each existing backup file will be committed as a new revision.
You can use this method even if you don't use KSaveFile.
</p>
<p></p>
<p>
<b>filename</b> - the file to backup</p>
<p>
<b>backupDir</b> - optional directory where to save the backup file in.
If empty (the default), the backup will be in the same directory as
<b>filename.</b></p>
<p>
<b>backupMessage</b> - is the RCS commit message for this revision.
Returns true if successful, or false if an error has occurred.
    </td>
  </tr>
</table>

</li><hr>

<li style="list-style-type : none"><b style="color : #000000;">setFileName</b> (filename)
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table vspace="5">
        <tr>
          <td>
            returns <i>Nothing</i>
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr  bgcolor="#e7e7ff">
                <th>Argument</th><th>Type</th><th>Default</th>
              </tr>
              <tr><td>filename</td><td>QString</td><td align="right"></td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Set the target filename for the save file.
You must use this to set the filename of the target file if you do
not use the contructor that does so.</p>
<p>
<b>filename</b> - Name of the target file.
    </td>
  </tr>
</table>

</li><hr>

<li style="list-style-type : none"><b style="color : #000000;">simpleBackupFile</b> (filename, backupDir, backupExtension)
<table width="100%">
  <tr>
    <td width="60%" valign="top">
      <table vspace="5">
        <tr>
          <td>
            returns <i>bool</i>
          </td>
        </tr>
        <tr>
          <td>
          <b style="color : #0000aa">static</b> 
          </td>
        </tr>
        <tr>
          <td>
          
          </td>
        <tr>
        <tr valign="bottom">
          <td>
            <table>
              <tr  bgcolor="#e7e7ff">
                <th>Argument</th><th>Type</th><th>Default</th>
              </tr>
              <tr><td>filename</td><td>QString</td><td align="right"></td></tr>
              <tr><td>backupDir</td><td>QString</td><td align="right">QString()</td></tr>
              <tr><td>backupExtension</td><td>QString</td><td align="right">QLatin1String("~")</td></tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
    <td width="40%" align="left">
Static method to create a backup file for a given filename.
</p>
<p>
This function creates a backup file from the given filename.
You can use this method even if you don't use KSaveFile.</p>
<p>
<b>filename</b> - the file to backup</p>
<p>
<b>backupDir</b> - optional directory where to save the backup file in.
If empty (the default), the backup will be in the same directory as <b>filename.</b></p>
<p>
<b>backupExtension</b> - the extension to append to <b>filename,</b> "~" by default.
Returns true if successful, or false if an error has occurred.
    </td>
  </tr>
</table>

</li><hr>

</li><hr>

</span>
</body>
</html>
